<!DOCTYPE html>
<html>
<head>
    <title>Kuiz Matematik Ceria! üéâ</title>
    
    <meta charset="UTF-8"> 
    
    <style>
        /* CSS UNTUK KUIZ CERIA */
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background-color: #f7f3ff;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 20px 10px;
            margin: 0;
        }

        .main-content {
            width: 95%;
            max-width: 500px;
        }

        .container {
            background-color: #ffffff;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 20px rgba(78, 43, 118, 0.15);
            text-align: center;
            margin-bottom: 20px;
            border: 3px solid #ffcc00;
        }

        h1 {
            color: #ff6f61;
            margin-bottom: 15px;
            font-size: 1.8em;
        }

        /* --- SKOR DAN KESUKARAN --- */
        .info-bar {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #a4e0a4;
            border-radius: 12px;
            font-weight: bold;
            color: #1e3a8a;
            border: 2px dashed #ffcc00;
        }
        
        .score-box {
            background-color: #fff;
            padding: 5px 8px;
            border-radius: 8px;
            border: 1px solid #7cb342;
            font-size: 0.8em;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        /* --- KAWALAN PENGGUNA --- */
        .controls, .settings {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap; 
        }

        .settings div {
            flex: 1;
            min-width: 110px; 
            margin: 5px;
        }

        .settings label, .pilihan-operasi label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
            color: #ff6f61;
        }

        #operasiPilihan, #bilanganSoalan, #levelOption, #nomborBerganda {
            padding: 8px;
            border-radius: 8px;
            border: 2px solid #66bb6a;
            font-size: 1em;
            width: 100%;
            box-sizing: border-box;
            background-color: #e8ffe8;
        }

        #resetBtn {
             background-color: #ff6f61;
             color: white;
             padding: 8px 15px;
             border: none;
             border-radius: 8px;
             cursor: pointer;
             font-size: 0.9em;
             transition: background-color 0.2s;
        }
        #resetBtn:hover { background-color: #e55c51; }

        /* --- SOALAN DAN INPUT (PERUBAHAN UTAMA UNTUK SUSUN ATUR OPERASI) --- */
        #soalan-lazim {
            display: flex;
            flex-direction: column;
            align-items: flex-end; 
            width: fit-content;
            margin: 20px auto; 
            font-size: 2.8em;
            font-weight: 900;
            color: #4c4c4c;
            background-color: #fff9c4;
            padding: 15px 30px;
            border-radius: 10px;
        }
        
        /* Gaya asas untuk elemen di dalam soalan lazim */
        #soalan-lazim p, #soalan-lazim span {
            margin: 0; 
            padding: 0; 
            line-height: 1.1;
        }
        
        /* Gaya untuk baris nombor kedua dan operasi */
        .row-nombor2 {
            display: flex;
            align-items: center;
            justify-content: flex-end; 
            width: 100%;
            padding-bottom: 5px; 
        }

        /* Simbol Operasi */
        #operasi {
            margin-right: 15px; 
            margin-left: -5px; 
        }
        
        /* Nombor Kedua */
        #nombor2 {
            text-align: right;
        }

        hr { 
            width: 100%; 
            border: 2px solid #ffcc00; 
            margin-top: 5px;
            margin-bottom: 10px; 
        }
        
        #jawapanInput {
            padding: 12px;
            margin-bottom: 15px;
            border: 3px solid #ffab40;
            border-radius: 10px;
            width: 80%;
            max-width: 250px;
            font-size: 1.4em;
            text-align: center;
            background-color: #fff0d9;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .semak-btn {
            background-color: #4db6ac;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.2em;
            transition: background-color 0.3s;
            box-shadow: 0 4px #388e8c;
        }
        .semak-btn:hover { 
            background-color: #388e8c; 
            transform: translateY(1px);
            box-shadow: 0 3px #388e8c;
        }
        .semak-btn:disabled {
            background-color: #ccc;
            box-shadow: none;
        }
        
        #maklumBalas { 
            margin-top: 20px; 
            font-size: 1.2em; 
            font-weight: 900; 
        }

        /* --- SEJARAH SOALAN --- */
        .history-section {
            width: 95%; 
            max-width: 500px;
            margin: 20px auto;
            padding: 15px;
            background-color: #e0f7fa;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            border: 2px solid #4db6ac;
        }

        .history-section h2 {
            margin-top: 0;
            color: #00897b;
            font-size: 1.3em;
            border-bottom: 2px dashed #80cbc4;
            padding-bottom: 10px;
        }

        #historyList {
            list-style: none;
            padding: 0;
            max-height: 200px;
            overflow-y: auto;
            text-align: left;
            font-size: 0.95em;
        }

        #historyList li {
            padding: 6px 0;
            border-bottom: 1px dotted #b2dfdb;
        }
        
        .correct { color: #2e7d32; }
        .incorrect { color: #d32f2f; }
    </style>
</head>
<body>

    <div class="main-content">
        <div class="container">
            <h1>Kuiz Matematik Ceria! üéâ</h1>
            
            <div class="info-bar">
                <div class="score-box">Betul: <span id="skorBetul">0</span></div>
                <div class="score-box">Salah: <span id="skorSalah">0</span></div>
                <div class="score-box">Peratus: <span id="peratus">0%</span></div>
                <div class="score-box">Level: <span id="level">1</span></div>
                <div class="score-box">Baki: <span id="bakiSoalan">--</span></div>
            </div>

            <div class="controls">
                <div class="settings">
                    <div class="pilihan-operasi">
                        <label for="operasiPilihan">Operasi:</label>
                        <select id="operasiPilihan" onchange="resetKuiz(); janaSoalan()">
                            <option value="+">Tambah (+)</option>
                            <option value="-">Tolak (-)</option>
                            <option value="*">Darab (√ó)</option>
                            <option value="/">Bahagi (√∑)</option>
                        </select>
                    </div>

                    <div>
                        <label for="bilanganSoalan">Jumlah Soalan:</label>
                        <input type="number" id="bilanganSoalan" value="10" min="1" onchange="resetKuiz()">
                    </div>

                    <div>
                        <label for="levelOption">Tetapan Level:</label>
                        <select id="levelOption" onchange="resetKuiz()">
                            <option value="menaik">Menaik</option>
                            <option value="1">Level 1</option>
                            <option value="2">Level 2</option>
                            <option value="3">Level 3</option>
                            <option value="4">Level 4</option>
                            <option value="5">Level 5</option>
                        </select>
                    </div>

                    <div>
                        <label for="nomborBerganda">Nombor Berganda?</label>
                        <select id="nomborBerganda" onchange="resetKuiz()">
                            <option value="no">Tidak</option>
                            <option value="yes_random">Ya (Rawak)</option>
                            <option value="yes_sequence">Ya (Menaik/Sequence)</option>
                        </select>
                    </div>
                </div>
                <button id="resetBtn" onclick="resetKuiz()">Reset & Mula Baru</button>
            </div>
            
            <div id="soalan-lazim">
                <p id="nombor1">--</p>
                <div class="row-nombor2">
                    <span id="operasi">?</span>
                    <span id="nombor2">--</span>
                </div>
                <hr>
            </div>
            
            <input type="number" id="jawapanInput" placeholder="Masukkan jawapan anda">
            <button class="semak-btn" onclick="semakJawapan()" id="semakBtn">Semak Jawapan</button>
            <p id="maklumBalas"></p>
        </div>

        <div class="history-section">
            <h2>Sejarah Jawapan üìù</h2>
            <ul id="historyList">
            </ul>
        </div>
    </div>

    <script>
        // JAVASCRIPT UNTUK LOGIK KUIZ
        let jawapanBetul;
        let soalanSemasa;
        let skorBetul = 0;
        let skorSalah = 0;
        let bilanganSoalanDijawab = 0;
        let tahap = 1;
        let maxSoalan;
        
        let sequenceCounter = 1; 

        // Had nombor maksimum mengikut tahap
        function dapatkanHadNombor(tahap) {
            // Julat untuk + dan -
            const hadTambahTolak = {
                1: { min: 1, max: 10 },
                2: { min: 10, max: 50 },
                3: { min: 50, max: 100 },
                4: { min: 100, max: 200 },
                5: { min: 200, max: 500 }
            };
            // Julat untuk x dan √∑
            const hadDarabBahagi = {
                1: { min_2d: 10, max_2d: 20, min_1d: 2, max_1d: 5 },
                2: { min_2d: 20, max_2d: 50, min_1d: 2, max_1d: 9 },
                3: { min_2d: 50, max_2d: 99, min_1d: 2, max_1d: 9 },
                4: { min_2d: 10, max_2d: 99, min_1d: 10, max_1d: 15 }, 
                5: { min_2d: 10, max_2d: 99, min_1d: 15, max_1d: 20 }
            };

            const operasi = document.getElementById('operasiPilihan').value;
            if (operasi === '*' || operasi === '/') {
                return hadDarabBahagi[tahap] || hadDarabBahagi[5];
            } else {
                return hadTambahTolak[tahap] || hadTambahTolak[5];
            }
        }
        
        function kemasKiniSkor() {
            bilanganSoalanDijawab = skorBetul + skorSalah;
            
            let peratusTepat = bilanganSoalanDijawab > 0 ? 
                                Math.round((skorBetul / bilanganSoalanDijawab) * 100) : 0;
            
            const baki = maxSoalan - bilanganSoalanDijawab;

            document.getElementById('skorBetul').textContent = skorBetul;
            document.getElementById('skorSalah').textContent = skorSalah;
            document.getElementById('peratus').textContent = `${peratusTepat}%`;
            document.getElementById('level').textContent = tahap;
            document.getElementById('bakiSoalan').textContent = baki >= 0 ? baki : 0;
        }

        function resetKuiz() {
            maxSoalan = parseInt(document.getElementById('bilanganSoalan').value);
            const levelPilihan = document.getElementById('levelOption').value;

            skorBetul = 0;
            skorSalah = 0;
            sequenceCounter = 1; 
            
            if (levelPilihan === 'menaik') {
                tahap = 1;
            } else {
                tahap = parseInt(levelPilihan);
            }
            
            kemasKiniSkor();
            document.getElementById('historyList').innerHTML = '';
            document.getElementById('maklumBalas').textContent = 'Kuiz Telah Ditetapkan Semula. Sila Jawab.';
            document.getElementById('semakBtn').disabled = false;
            
            document.getElementById('nombor1').textContent = '--';
            document.getElementById('nombor2').textContent = '--';
            document.getElementById('operasi').textContent = '?';
            
            janaSoalan();
        }

        function tambahKeSejarah(isCorrect, soalan, jawapanPengguna, jawapanBetul) {
            const list = document.getElementById('historyList');
            const item = document.createElement('li');
            
            const simbolStatus = isCorrect ? '‚úîÔ∏è' : '‚ùå';
            const statusClass = isCorrect ? 'correct' : 'incorrect';
            
            item.innerHTML = `<span class="${statusClass}">${simbolStatus}</span> 
                              **Level ${tahap}**: ${soalan} = ${jawapanBetul}. Jawapan anda: ${jawapanPengguna}`;
            
            list.prepend(item); 
        }

        function tamatkanKuiz() {
            document.getElementById('soalan-lazim').innerHTML = '<p style="font-size: 1.5em; color: #ff6f61;">Kuiz Tamat! Tahniah! üèÜ</p>';
            document.getElementById('maklumBalas').textContent = `Kuiz Tamat! Skor Akhir: ${skorBetul} Betul / ${skorSalah} Salah.`;
            document.getElementById('jawapanInput').value = '';
            document.getElementById('semakBtn').disabled = true;
        }

        function janaNomborRawak(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function janaSoalan() {
            if (bilanganSoalanDijawab >= maxSoalan) {
                tamatkanKuiz();
                return;
            }

            const levelPilihan = document.getElementById('levelOption').value;
            if (levelPilihan === 'menaik' && bilanganSoalanDijawab > 0 && bilanganSoalanDijawab % 2 === 0) {
                tahap++;
                if (tahap > 5) tahap = 5; 
            }

            kemasKiniSkor();
            
            const had = dapatkanHadNombor(tahap);
            const operasiPilihan = document.getElementById('operasiPilihan').value;
            const nomborBergandaPilihan = document.getElementById('nomborBerganda').value;
            
            let num1, num2;
            jawapanBetul = 0; 
            
            // --- Logik Penjanaan Nombor ---
            if (operasiPilihan === '*' || operasiPilihan === '/') {
                
                if (operasiPilihan === '/') {
                    // Logik Bahagi xx √∑ x
                    let jawapan = janaNomborRawak(2, 9);
                    num2 = janaNomborRawak(2, 9);
                    num1 = num2 * jawapan; 
                    
                    if (num1 < 10 || num1 > 99) return janaSoalan(); 
                    
                    jawapanBetul = jawapan; 
                    
                } else if (nomborBergandaPilihan === 'yes_sequence') {
                    // Logik Darab Berganda Menaik (1x1, 2x2, dst.)
                    num1 = sequenceCounter;
                    num2 = sequenceCounter;
                    jawapanBetul = num1 * num2;
                    sequenceCounter++; 
                    
                    if (sequenceCounter > 20) {
                        document.getElementById('nomborBerganda').value = 'yes_random';
                        return janaSoalan(); 
                    }

                } else if (nomborBergandaPilihan === 'yes_random') {
                    // Logik Darab Berganda Rawak
                    num1 = janaNomborRawak(had.min_2d, had.max_2d);
                    num2 = num1; 
                    jawapanBetul = num1 * num2;

                } else {
                    // Logik Darab Biasa (xx * x)
                    num1 = janaNomborRawak(had.min_2d, had.max_2d);
                    num2 = janaNomborRawak(had.min_1d, had.max_1d);
                    jawapanBetul = num1 * num2;
                }
            } else { 
                // Logik Tambah dan Tolak
                const hadTT = dapatkanHadNombor(tahap);
                
                if (nomborBergandaPilihan === 'yes_random' || nomborBergandaPilihan === 'yes_sequence') {
                     num1 = janaNomborRawak(hadTT.min, hadTT.max);
                     num2 = num1;
                } else {
                    num1 = janaNomborRawak(hadTT.min, hadTT.max);
                    num2 = janaNomborRawak(hadTT.min, hadTT.max);
                }

                if (operasiPilihan === '+') {
                    jawapanBetul = num1 + num2;
                } else if (operasiPilihan === '-') {
                    if (num1 < num2) { [num1, num2] = [num2, num1]; }
                    jawapanBetul = num1 - num2;
                }
            }
            // --- Akhir Logik Penjanaan Nombor ---

            let simbol = operasiPilihan;
            if (operasiPilihan === '*') simbol = '√ó';
            if (operasiPilihan === '/') simbol = '√∑';

            soalanSemasa = `${num1} ${simbol} ${num2}`; 
            
            document.getElementById('nombor1').textContent = num1;
            document.getElementById('nombor2').textContent = num2;
            document.getElementById('operasi').textContent = simbol;
            
            document.getElementById('jawapanInput').value = '';
            document.getElementById('maklumBalas').textContent = '';
            document.getElementById('jawapanInput').focus();
        }

        function semakJawapan() {
            if (bilanganSoalanDijawab >= maxSoalan) return;

            const inputPengguna = document.getElementById('jawapanInput').value;
            const jawapanPengguna = parseInt(inputPengguna);
            const maklumBalasElement = document.getElementById('maklumBalas');

            if (inputPengguna === "" || isNaN(jawapanPengguna)) {
                 maklumBalasElement.textContent = "Sila masukkan jawapan yang sah!";
                 maklumBalasElement.style.color = "orange";
                 return; 
            }

            let isCorrect = (jawapanPengguna === jawapanBetul);

            if (isCorrect) {
                maklumBalasElement.textContent = "‚úÖ Tepat Sekali! Jawapan BETUL. Hebat! ‚ú®";
                maklumBalasElement.style.color = "#2e7d32";
                skorBetul++;
            } else {
                maklumBalasElement.textContent = `‚ùå Jawapan SALAH. Jawapan betul ialah ${jawapanBetul}. Cuba lagi! üß†`;
                maklumBalasElement.style.color = "#d32f2f";
                skorSalah++;
            }
            
            tambahKeSejarah(isCorrect, soalanSemasa, jawapanPengguna, jawapanBetul);
            
            setTimeout(() => {
                janaSoalan(); 
            }, 1500); 
            
            kemasKiniSkor();
        }

        resetKuiz();
    </script>
</body>
</html>
